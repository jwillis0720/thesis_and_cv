\chapter{Appendix: Protocol capture for chapter \ref{chap:nv_kbp}}

\section{Introduction}

This chapter describes the weight optimization, benchmarking and analysis performed in the work detailed in chapter \ref{chap:nv_kbp}.
Note that the protocol described here was originally performed using Rosetta SVN revision 39040.
In the time since the work described in Chapter \ref{chap:nv_kbp} was performed, the OptE application used here has been drastically rewritten.
As a result, this procedure should not be expected to function correctly (or at all!) when using Rosetta revisions after 39040.

All files referenced in this protocol can be found in the DVD set attached to this thesis. 

\section{Protocol}

\subsection{Weight Optimization}
\label{subsec:nv_weight_opt}
\subsubsection{Overview}
This protocol performs a five way cross validation optimization of the neighbor vector score function using the rosetta optE\_parallel application.
In this setup, 20 rounds of optimization are performed, and the reference energies, fa\_sol and neigh\_vect scoring function are allowed to freely optimize.
The weights are optimized both to maximize \ac{PSSM} score and to maintain the overall native sequence composition.

\subsubsection{Preparing input structures}
\label{subsubsec:nv_input_prep}
Prior to running OptE, all input crystal structures should be cleaned and relaxed.
To clean the input structures, remove all \ac{PDB} lines other than ATOM records.
Relaxation is performed using the Rosetta relax application, and the sequence relax protocol.
This protocol can be executed as follows:

\singlespace
\begin{Verbatim}
relax.default.linuxgccrelease -database minirosetta_database/ \
-l input.list -relax:sequence -ex1 -ex2 -ex1aro
\end{Verbatim}
\doublespace

Where input.list contains a list of paths to the input \ac{PDB} files.
Relaxed files using this method have been provided in Optimization/input\_files/input\_pdbs/

\subsubsection{Generating \acs{PSSM} files}
\ac{PSSM} files must additionally be generated for each \ac{PDB} file prepared in section \ref{subsubsec:nv_input_prep}.
To generate \ac{PSSM} files, first use the provided script, getFastaFromCoords.pl to create a fasta file based on the relaxed crystal structure.
getFastaFromCoords.py is run as follows:

\singlespace
\begin{Verbatim}
getFastaFromCoords.pl -pdbfile input.pdb > input.pdb.fasta
\end{Verbatim}
\doublespace

The resulting fasta file will then be used as input to \ac{BLAST} to create a \ac{PSSM} file.
As the \ac{BLAST} webserver does not provide \ac{PSSM} files as output in the proper format, the \ac{BLAST} application will be used, and is executed as follows:

\singlespace
\begin{Verbatim}
runblast input.pdb.fasta
\end{Verbatim}
\doublespace

The resulting file will produce, among other things, a \ac{PSSM} file with the file extension .ascii.
This .ascii file will be converted to the format required by Rosetta using the provided script convertpssm.py.
The Rosetta expects that the \ac{PSSM} information be provided as a text file, in which each line of the text file contains the one letter code of a native amino acid, followed by the percentage of observed mutations seen by blast, ordered in alphabetical order by one letter code, and separated by spaces.
This file can be produced using the \ac{PSSM} generated by blast by running the convertpssm.py script:

\singlespace
\begin{Verbatim}
convertpssm.py -i input.pdb.ascii -o input.fasta.probs
\end{Verbatim}
\doublespace

Note that OptE requires that the file produced by convertpssm.py begin with with the name of the original pdb file, and end with the suffix .ascii.probs.
Additionally, this file must be present in the same directory as the input \ac{PDB} file.
Thus, a \ac{PDB} file called "input.pdb" should have a \ac{PSSM} file of the same name titled input.fasta.probs.
These files are provided in the Optimization/input\_files/input\_pdbs directory.

\subsubsection{Running OptE}
3 sets of optimization were performed using OptE: the optimization of the \ac{NV} environment \ac{KBP}, optimization of the reference energies only, and optimization of the reference energies of the final averaged \ac{NV} environment \ac{KBP} energy function.
The command files for each optimization are designated by their suffix, and are located in the Optimization/input\_files directory.
"kbp" for files relating to the \ac{NV} environment \ac{KBP} optimization, "ref" for files relating to reference energy optimization, and "avg" for files relating to optimization of the averaged energy function.  

In this case, a template \ac{PBS} file was used, and variables were passed in to this \ac{PBS} file to start each section of the five way cross validation.
The template file is located in input\_files/optimization\_x.pbs, and the submission commands are located in\\
input\_files/submit\_commands\_x.txt.

See input\_files/flags\_x.txt for the options and comments describing what these options do for each of the 3 optimization experiments performed. 

\subsection{Weight validation and analysis}

\subsubsection{Benchmarking of optimized weights}

The weight sets optimized in section \ref{subsec:nv_weight_opt} were benchmarked using the Rosetta fixbb application.
Fixbb conducts fixed backbone design over the entire protein, using the specified weight set. 
An example command line and flags files can be found in the Benchmark/input\_files directory.
Fixed backbone design was performed on all proteins in both the 100 and 42 protein benchmark sets described in chapter \ref{subsubsec:nv_input_prep}.

\subsubsection{Analysis of benchmarking data}

After the benchmarking designs were performed, the computation of sequence recovery and \ac{PSSM} recovery was carried out using the script design\_benchmark\_protocol.py, which is provided in the Benchmark/input\_files directory.
This script takes as input a list of paths to native protein structures, and a list of paths to designed protein structures, and outputs a set of \ac{CSV} files containing the statistics reported in Chapter \ref{chap:nv_kbp}.
The script should be run as:

\singlespace
\begin{Verbatim}
design_benchmark_protocol.py --prefix prefix_file \
native_list.txt designed_list.txt
\end{Verbatim}
\doublespace
